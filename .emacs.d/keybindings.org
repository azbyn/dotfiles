* =C-c= and hyper bindings
   I keep them here so i don't define the same key multiple times.
   I define them for both =C-c= and hyper because i don't have my hyper key when
   in a terminal

#+BEGIN_SRC emacs-lisp
  (defun global-set-hyper-key (keyChar func)
    (global-set-key (kbd (concat "C-c " keyChar)) func)
    (global-set-key (kbd (concat "H-" keyChar)) func))
#+END_SRC
** config related
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "r" 'config-reload)
  (global-set-hyper-key "e" 'config-visit)
  (global-set-hyper-key "E" 'config-visit-readonly)
#+END_SRC
** show flycheck errors
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "F" 'flycheck-list-errors)
#+END_SRC
** delete word
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "w" 'daedreth/kill-inner-word)
#+END_SRC
** evil join
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "j" 'evil-join)
#+END_SRC
** sort
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "s" 'sort-lines)
  (global-set-hyper-key "S" 'sort-fields)
#+END_SRC
# *** evil delete
# #+BEGIN_SRC emacs-lisp
#  (global-set-hyper-key "d" 'evil-delete)
# #+END_SRC
** evil visual block
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "v" 'evil-visual-block)
#+END_SRC
** evil ex
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key ":" 'evil-ex)
  (global-set-hyper-key ";" 'evil-ex)
#+END_SRC
** quote
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "q" 'quoted-insert)
#+END_SRC
** delete window
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "Q" 'delete-window)
#+END_SRC
** ffip
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "b" 'azbyn/ffip)
  (global-set-key (kbd "M-z") 'azbyn/ffip)
#+END_SRC
** beginning of line
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "a" 'beginning-of-line)
#+END_SRC
** kill this buffer
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "k" 'kill-this-buffer)
#+END_SRC
** exit minibuffer
#+BEGIN_SRC emacs-lisp
  (global-set-hyper-key "g" 'exit-minibuffer)
#+END_SRC
* transpose
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-x T") 'transpose-chars)
  (global-set-key (kbd "C-x t") 'transpose-words)
#+END_SRC
* key maps
** M-g
*** movement
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "M-g t") 'beginning-of-buffer)
  (global-set-key (kbd "M-g b") 'end-of-buffer)
  (global-set-key (kbd "M-g a") 'avy-goto-char)
#+END_SRC
*** dumb jump
#+BEGIN_SRC emacs-lisp
  (use-package dumb-jump
    :ensure t)
#+END_SRC
#+BEGIN_SRC emacs-lisp
  (defun azbyn/nothing ()
    (interactive)
    (message "not implemented"))
  (defvar azbyn/goto-definition-function 'dumb-jump-go)
  (defvar azbyn/search-symbol-function 'azbyn/nothing)
  (defun azbyn/goto-definition ()
    (interactive)
    (call-interactively azbyn/goto-definition-function))
  (defun azbyn/search-symbol ()
    (interactive)
    (call-interactively azbyn/goto-symbols-function))
  (global-set-key (kbd "M-g d") 'azbyn/goto-definition)
  (global-set-key (kbd "M-g q") 'azbyn/goto-quick-bookmark)
  (global-set-key (kbd "M-g s") 'azbyn/search-symbol)

#+END_SRC
** fill map
#+BEGIN_SRC emacs-lisp
  (define-prefix-command 'fill-key-map)
  (define-key 'fill-key-map (kbd "s") 'set-fill-column)
  (define-key 'fill-key-map (kbd "c l") 'center-line)
  (define-key 'fill-key-map (kbd "c p") 'center-paragraph)
  (define-key 'fill-key-map (kbd "r") 'fill-region)
  (define-key 'fill-key-map (kbd "p") 'fill-region-as-paragraph)
  (define-key 'fill-key-map (kbd "P") 'fill-paragraph)
#+END_SRC
** azbyn's custom map
#+BEGIN_SRC emacs-lisp
  (define-prefix-command 'azbyn-key-map)
  (defun azbyn/eval-region ()
    (interactive)
    (call-interactively 'eval-region);; (region-beginning) (region-end))
    (message "Evaluated region"))
  (defun azbyn/eval-buffer ()
    (interactive)
    (eval-buffer)
    (message "Evaluated buffer"))


  (define-key 'azbyn-key-map (kbd "e r") 'azbyn/eval-region)
  (define-key 'azbyn-key-map (kbd "e b") 'azbyn/eval-buffer)
  (define-key 'azbyn-key-map (kbd "C-a") 'flyspell-buffer)

  (define-key 'azbyn-key-map (kbd "q") 'quoted-insert)
  (define-key 'azbyn-key-map (kbd "s") 'eshell)
  (define-key 'azbyn-key-map (kbd "r") 'revert-buffer)

  (define-key 'azbyn-key-map (kbd "u") 'upcase-dwim)
  (define-key 'azbyn-key-map (kbd "d") 'downcase-dwim)

  (define-key 'azbyn-key-map (kbd "TAB") 'ff-find-other-file)
  (define-key 'azbyn-key-map (kbd "SPC") 'counsel-switch-buffer)

  (define-key 'azbyn-key-map (kbd "C-SPC") 'azbyn/goto-quick-bookmark)
#+END_SRC
*** transpose
#+BEGIN_SRC emacs-lisp
  (define-key 'azbyn-key-map (kbd "t") 'my-c-transpose-args-backward)
  (define-key 'azbyn-key-map (kbd "C-t") 'my-c-transpose-args-forward)
#+END_SRC
*** bookmarks
#+BEGIN_SRC emacs-lisp
  (define-prefix-command 'azbyn/bookmarks-map)
  (defvar azbyn/bookmark-index 0)
  (defun azbyn/quick-bookmark-impl()
    (bookmark-set (format "quick-%s" azbyn/bookmark-index)))
  (defun azbyn/quick-bookmark()
    (interactive)
    (azbyn/quick-bookmark-impl)
    (message "Quick bookmark set"))

  ;;and set the other bookmark to previous point
  ;; kinda like exchange-mark-and-point
  (defun azbyn/goto-quick-bookmark()
    (interactive)
    (let ((old-index azbyn/bookmark-index))
      (setq azbyn/bookmark-index (% (+ 1 azbyn/bookmark-index) 2))
      (azbyn/quick-bookmark-impl)
      (bookmark-jump (format "quick-%s" old-index))))


  (define-key 'azbyn-key-map (kbd "M-a") 'azbyn/quick-bookmark)

  (define-key 'azbyn-key-map (kbd "b") azbyn/bookmarks-map)

  (define-key 'azbyn/bookmarks-map (kbd "q") 'azbyn/quick-bookmark)

  (define-key 'azbyn/bookmarks-map (kbd "a") 'bookmark-set)
  (define-key 'azbyn/bookmarks-map (kbd "s") 'bookmark-set)

  (define-key 'azbyn/bookmarks-map (kbd "j") 'bookmark-jump)
  (define-key 'azbyn/bookmarks-map (kbd "b") 'bookmark-jump)

  (define-key 'azbyn/bookmarks-map (kbd "d") 'bookmark-delete)
#+END_SRC
*** open some =*buffer*=
#+BEGIN_SRC emacs-lisp
  (defvar azbyn/repl-name "*scratch*")

  (defun azbyn/open-repl()
    (interactive)
    (switch-to-buffer azbyn/repl-name))
  (defun azbyn/open-help() (interactive) (switch-to-buffer "*Help*"))
  (defun azbyn/open-scratch() (interactive) (switch-to-buffer "*scratch*"))

  (defun azbyn/open-compilation() (interactive) (switch-to-buffer "*compilation*"))
  (defun azbyn/open-messages() (interactive) (switch-to-buffer "*Messages*"))

  (define-key 'azbyn-key-map (kbd "M-h") 'azbyn/open-help)
  (define-key 'azbyn-key-map (kbd "M-s") 'azbyn/open-scratch)
  (define-key 'azbyn-key-map (kbd "M-c") 'azbyn/open-compilation)
  (define-key 'azbyn-key-map (kbd "M-r") 'azbyn/open-repl)
  (define-key 'azbyn-key-map (kbd "M-m") 'azbyn/open-messages)

#+END_SRC
*** goto
#+BEGIN_SRC emacs-lisp
  (define-prefix-command 'azbyn/goto-map)

  (define-key 'azbyn-key-map (kbd "g") azbyn/goto-map)

  (defun azbyn/goto-awesome()   (interactive) (dired "~/.config/awesome"))
  (defun azbyn/goto-bin()       (interactive) (dired "~/bin"))
  (defun azbyn/goto-downloads() (interactive) (dired "~/Downloads"))
  (defun azbyn/goto-emacs()     (interactive) (dired "~/.emacs.d"))
  (defun azbyn/goto-git-dir()   (interactive) (dired "~/Git"))
  (defun azbyn/goto-home()      (interactive) (dired "~"))
  (defun azbyn/goto-projects()  (interactive) (dired "~/Projects"))
  (defun azbyn/goto-music()     (interactive) (dired "~/Music"))

  (define-key 'azbyn/goto-map (kbd "a") 'azbyn/goto-awesome)
  (define-key 'azbyn/goto-map (kbd "b") 'azbyn/goto-bin)
  (define-key 'azbyn/goto-map (kbd "d") 'azbyn/goto-downloads)
  (define-key 'azbyn/goto-map (kbd "e") 'azbyn/goto-emacs)
  (define-key 'azbyn/goto-map (kbd "g") 'azbyn/goto-git-dir)
  (define-key 'azbyn/goto-map (kbd "h") 'azbyn/goto-home)
  (define-key 'azbyn/goto-map (kbd "p") 'azbyn/goto-projects)
  (define-key 'azbyn/goto-map (kbd "m") 'azbyn/goto-music)

  (define-key 'azbyn/goto-map (kbd "C-c") 'config-visit)
  (define-key 'azbyn/goto-map (kbd "C-S-c") 'config-visit-readonly)
  (define-key 'azbyn/goto-map (kbd "C-k") 'keybindings-visit)
  (define-key 'azbyn/goto-map (kbd "C-S-k") 'keybindings-visit-readonly)
#+END_SRC
*** spell checking bindings
#+BEGIN_SRC emacs-lisp
  (define-prefix-command 'azbyn/spellcheck-map)

  (define-key 'azbyn-key-map (kbd "S") azbyn/spellcheck-map)

  (define-key 'azbyn/spellcheck-map (kbd "b") 'flyspell-buffer)
  (define-key 'azbyn/spellcheck-map (kbd "B") 'ispell-buffer)
  (define-key 'azbyn/spellcheck-map (kbd "w") 'ispell-word)
  (define-key 'azbyn/spellcheck-map (kbd "d") 'ispell-change-dictionary)
  (define-key 'azbyn/spellcheck-map (kbd "s") 'flyspell-mode)
  (define-key 'azbyn/spellcheck-map (kbd "k") 'ispell-kill-ispell)
#+END_SRC

* weird movement
** use C-i C-j for horizontal movement
#+BEGIN_SRC emacs-lisp
  (define-key input-decode-map "\C-i" [C-i])
  (define-key input-decode-map "\C-j" [C-j])

  (global-set-key [C-j] 'next-line)
  (global-set-key [C-i] 'previous-line)

  ;;;todo
  (defun azbyn/minibuffer-movement ()
    (interactive)
    (local-set-key [C-i] 'previous-line-or-history-element)
    (local-set-key [C-j] 'next-line-or-history-element))
  (add-hook 'minibuffer-inactive-mode-hook 'azbyn/minibuffer-movement)

#+END_SRC
** scrolling
#+BEGIN_SRC emacs-lisp
  (defun azbyn/scroll-up() (interactive) (forward-line -10))
  (defun azbyn/scroll-down() (interactive) (forward-line 10))

  (global-set-key (kbd "M-j") 'azbyn/scroll-down)
  (global-set-key (kbd "M-i") 'azbyn/scroll-up)
#+END_SRC
** force myself to not use the arrow keys
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "<left>") nil)
  (global-set-key (kbd "<right>") nil)
  (global-set-key (kbd "<up>") nil)
  (global-set-key (kbd "<down>") nil)

  (global-set-key (kbd "C-<left>") nil)
  (global-set-key (kbd "C-<right>") nil)
  (global-set-key (kbd "C-<up>") nil)
  (global-set-key (kbd "C-<down>") nil)
#+END_SRC
** delete window
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "M-Q") 'delete-window)
#+END_SRC
** exchange point and mark
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "M-P") 'exchange-point-and-mark)
#+END_SRC
** mark related
#+BEGIN_SRC emacs-lisp
  (defun azbyn/select-downwards ()
    (interactive)
    (set-mark (point-at-bol))
    (end-of-line)
    (forward-line 2))
  (defun azbyn/select-upwards ()
    (interactive)
    (set-mark (point-at-eol))
    (beginning-of-line)
    (forward-line -1))
  (defun azbyn/select-line()
    (interactive)
    (set-mark (point-at-bol))
    (end-of-line))
  (defun azbyn/mark-to-eol()
    (interactive)
    (set-mark (point-at-eol)))

  (defun azbyn/mark-whole-word()
    (interactive)
    (forward-char)
    (set-mark (azbyn/get-point 'azbyn/backward-word-begin))
    (azbyn/forward-word-end))

  (defun azbyn/mark-to-eof()
    (interactive)
      (save-excursion
        (set-mark (azbyn/get-point 'end-of-buffer))))

  (defun azbyn/mark-to-bof()
    (interactive)
      (save-excursion
        (set-mark (azbyn/get-point 'beginning-of-buffer))))

  (define-prefix-command 'mark-key-map)
  (global-set-key (kbd "M-m") 'mark-key-map)

  (global-set-key (kbd "M-m <C-i>") 'azbyn/select-upwards)
  (global-set-key (kbd "M-m <C-j>") 'azbyn/select-downwards)
  ;;select line
  (global-set-key (kbd "M-m l") 'azbyn/select-line)

  (global-set-key (kbd "M-m f") 'mark-defun)
  (global-set-key (kbd "M-m s") 'exchange-point-and-mark)

  (global-set-key (kbd "M-m p") 'mark-paragraph)
  (global-set-key (kbd "M-m r") 'rectangle-mark-mode)
  (global-set-key (kbd "M-m e") 'azbyn/mark-to-eol)
  (global-set-key (kbd "M-m b") 'azbyn/mark-to-bol)
  (global-set-key (kbd "M-m E") 'azbyn/mark-to-eof)
  (global-set-key (kbd "M-m B") 'azbyn/mark-to-bof)

  (global-set-key (kbd "M-m w") 'azbyn/mark-whole-word)

#+END_SRC
** set keys which are often overwritten by modes *cough org*
*** infrastructure
#+BEGIN_SRC emacs-lisp

  (defvar azbyn/key-bindings-table
    (make-hash-table :test 'equal))
  (defun azbyn/define-key (key value)
    "Define a key which often gets overridden"
    (puthash key value azbyn/key-bindings-table))

  ;;(defvar azbyn/original-keys nil)
  ;;(make-variable-buffer-local 'azbyn/original-keys)
  (defun azbyn/gen-call-original (key alternative)
    "You might want to call the mode's purpose for a key
     for example C-a which gets overridden in eshell mode."
    (cons (kbd key) alternative))
  (defun azbyn/force-key-bindings()
    (interactive)
    (let ((og-keys (key-binding [f14]))) ;(or azbyn/original-keys (current-local-map))))
        ;;(unless azbyn/original-keys
                                          ;(message "set-original-keys")
                                          ;)
        ;; (setq azbyn/original-keys (key-binding [f14]))
        (maphash
         (lambda (k v)
           ;;(princ (format "m16 %s %s =%s\n" k v
           ;;               (if og-keys "Y" "N")))
           (let ((new-val
                  (if (consp v); from azbyn/get-call-original: car = key; cdr = default
                      (if og-keys
                          (let ((old-key (lookup-key og-keys (car v))))
                            ;;(princ (message "old-key %s\n" old-key))
                            (or old-key (cdr v)))
                        ;;(princ "WTF, original is null!\n")
                        (cdr v)
                        )
                    v)))
             (local-set-key k new-val)
             ;;(princ (format "m %s %s\n" k new-val))
             ))
         azbyn/key-bindings-table)))
  (defun azbyn/key-bindings ()
    (interactive)
    ;;(princ (format "\n\nname: %s\n" mode-name))
    ;;(princ (format "before? %s\n"
    ;;               (if (key-binding [f14]) "Y" "N")))
    (unless (key-binding [f14])
      ;;(princ "!!!!!!setkey!\n")
      ;;(setq azbyn/thing 
      (local-set-key [f14] (current-local-map));)
      (azbyn/force-key-bindings)
    ;; (unless azbyn/original-keys
    ;;   (princ "setazbyn!\n")
    ;;   (setq-local azbyn/original-keys (current-local-map)))
    ;;(princ (format "after? %s\n" (if (key-binding [f14]) "Y" "N")))
      ))


  (add-hook 'after-change-major-mode-hook 'azbyn/key-bindings)
  (add-hook 'messages-buffer-mode-hook 'azbyn/key-bindings)
  ;(add-hook 'dashboard-mode-hook 'azbyn/key-bindings)
  (add-hook 'minibuffer-setup-hook 'azbyn/key-bindings)
  ;;(add-hook 'ivy-mode-hook 'azbyn/key-bindings)
#+END_SRC
**** =messages= won't get the keybindings
#+BEGIN_SRC emacs-lisp
  (with-current-buffer "*Messages*"
    (azbyn/key-bindings))
#+END_SRC

*** the actual keys
#+BEGIN_SRC emacs-lisp
  ;;(global-set-key (kbd "C-a") 'back-to-indentation)
  ;;(global-set-key (kbd "C-e") 'end-of-line)
  ;; (define-key input-decode-map "\C-a" [C-a])
  ;; (define-key input-decode-map "\C-e" [C-e])
  ;; (define-key input-decode-map "\C-p" [C-p])
  ;; (define-key input-decode-map "\C-n" [C-n])

  ;; (define-key input-decode-map "\M-p" [M-p])
  ;; (define-key input-decode-map "\M-n" [M-n])

  ;; (define-key input-decode-map "\C-\M-e" [C-M-e])



  (azbyn/define-key (kbd "C-q") (azbyn/gen-call-original "C-a" 'back-to-indentation))
  (azbyn/define-key (kbd "C-r") (azbyn/gen-call-original "C-e" 'end-of-line))

  (azbyn/define-key (kbd "M-q") (azbyn/gen-call-original "M-a" 'backward-paragraph))
  (azbyn/define-key (kbd "M-r") (azbyn/gen-call-original "M-e" 'forward-sentence))
  ;;;
  (azbyn/define-key (kbd "C-a") 'backward-char)
  (azbyn/define-key (kbd "C-f") 'forward-char)

  (azbyn/define-key (kbd "M-I") (azbyn/gen-call-original "M-p" 'move-lines-up))
  (azbyn/define-key (kbd "M-J") (azbyn/gen-call-original "M-n" 'move-lines-down))

  (azbyn/define-key (kbd "C-e") 'azbyn/forward-word-begin)
  (azbyn/define-key (kbd "C-w") 'azbyn/backward-word-begin)

  (azbyn/define-key (kbd "M-e") 'azbyn/forward-subword-begin)
  (azbyn/define-key (kbd "M-w") 'azbyn/backward-subword-end)

  (azbyn/define-key (kbd "C-M-e") 'azbyn/forward-subword-end)
  (azbyn/define-key (kbd "C-M-w") 'azbyn/backward-subword-begin)


  (azbyn/define-key (kbd "M-f") 'fill-key-map)
  (azbyn/define-key (kbd "M-a") 'azbyn-key-map)




  (global-set-key (kbd "C-d") 'azbyn/delete-char-or-region)
  (global-set-key (kbd "M-d") 'azbyn/kill-word)
  (global-set-key (kbd "C-M-d") 'azbyn/kill-subword)


  (azbyn/define-key (kbd "C-n") 'evil-find-char)
  (azbyn/define-key (kbd "C-b") 'evil-find-char-to-backward)

  (global-set-key (kbd "C-'") 'recenter-top-bottom)
  ;; ;;org mode likes rebinding C-k
  (azbyn/define-key (kbd "M-k") 'azbyn/kill-whole-line-or-append-region)
  (azbyn/define-key (kbd "C-M-k") 'append-next-kill)

  (azbyn/define-key (kbd "C-l") 'azbyn/copy-to-eol-or-region)
  (global-set-key (kbd "C-S-l") 'azbyn/copy-whole-word)
  (global-set-key (kbd "M-L") 'azbyn/copy-whole-subword)

  (azbyn/define-key (kbd "C-k") 'azbyn/kill-to-eol-or-region)
  ;; azbyn/define-key doesn't like lambdas and we can use global-set-key
  (global-set-key (kbd "M-l") (lambda ()
                                (interactive)
                                (call-interactively 'evil-yank-line)
                                (message "yanked line")))

  (global-set-key (kbd "C-S-k") 'azbyn/kill-whole-word)
  (global-set-key (kbd "M-K") 'azbyn/kill-whole-subword)


  (azbyn/define-key (kbd "C-p") 'yank); azbyn/paste)
  (azbyn/define-key (kbd "C-S-p") 'azbyn/paste-before)
  (azbyn/define-key (kbd "M-p") 'azbyn/paste)
  (azbyn/define-key (kbd "M-P") 'azbyn/paste-before)

  (azbyn/define-key (kbd "M-n") 'evil-search-next)
  (azbyn/define-key (kbd "M-b") 'evil-search-previous)

  (global-set-key (kbd "C-M-f") 'forward-sexp)
  (global-set-key (kbd "C-M-a") 'backward-sexp)
  ;;(global-set-key (kbd "C-t") 'zop-up-to-char);;  evil-find-char)

  (global-set-key (kbd "C-z") 'zap-up-to-char)

  (global-set-key (kbd "C-v") 'yank);; azbyn/paste)
  (global-set-key (kbd "C-S-v") 'azbyn/paste-before)

  (global-set-key (kbd "M-v") 'counsel-yank-pop)

  ;; ;(global-set-key (kbd "M-y") 'evil-join)

  (global-set-key (kbd "M-`") 'evil-invert-char)
  (global-set-key (kbd "C-2") 'evil-invert-char)

  ;(global-set-key (kbd "C-u") 'universal-argument)
  (global-set-key (kbd "M-u") 'undo-tree-undo)
  (global-set-key (kbd "M-U") 'undo-tree-redo)

  (global-set-key (kbd "M-h") 'undo-tree-redo)
  ;; *** defun movement?
  ;(global-set-key (kbd "M-g") 'beginning-of-defun)
  ;;(global-set-key (kbd "M-g") 'end-of-defun)

  (global-set-key (kbd "<C-tab>") 'er-switch-to-previous-buffer)

  ;;(global-set-key (kbd "M-t") 'evil-delete)
  ;;(global-set-key (kbd "M-y") 'evil-yank)
  ;;(global-set-key (kbd "M-e") 'er/expand-region)
  ;;(global-set-key (kbd "M-s") 'er/contract-region)

  ;; we set this there so that when it's not overritten we

  ;;(defun azbyn/key-bindings ()
    ;;(interactive)

    ;; (unless (key-binding [f13])
    ;;   (let (
    ;;         ;; we MUST set these keys again here, otherwise
    ;;         ;; we won't override anything with global-set-key
    ;;         (old/beg-of-line (key-binding "\C-a"))
    ;;         (old/end-of-line (key-binding "\C-e"))
    ;;         (old/beg-of-stmt (key-binding "\M-a"))
    ;;         (old/end-of-stmt (key-binding "\M-e"))
    ;;         (old/delete-char (key-binding "\C-d"))
    ;;         (old/M-p (key-binding "\M-p"))
    ;;         (old/M-n (key-binding "\M-n"))
    ;;         )
        ;; (local-set-key [f13] 'eshell);actual value doesn't matter
        ;; ;;(message "hi from %s" major-mode)
        ;; (local-set-key (kbd "C-q") old/beg-of-line)
        ;; (local-set-key (kbd "C-r") old/end-of-line)
        ;; (local-set-key (kbd "M-r") old/end-of-stmt)

        ;; (local-set-key (kbd "M-q") old/beg-of-stmt)
        ;; (local-set-key (kbd "C-a") 'backward-char)
        ;; (local-set-key (kbd "C-f") 'forward-char)

        ;; (local-set-key (kbd "M-I") old/M-p)
        ;; (local-set-key (kbd "M-J") old/M-n)

        ;; (local-set-key (kbd "C-e") 'azbyn/forward-word-begin)
        ;; (local-set-key (kbd "C-w") 'azbyn/backward-word-begin)

        ;; (local-set-key (kbd "M-e") 'azbyn/forward-subword-begin)
        ;; (local-set-key (kbd "M-w") 'azbyn/backward-subword-end)

        ;; (local-set-key (kbd "C-M-e") 'azbyn/forward-subword-end)
        ;; (local-set-key (kbd "C-M-w") 'azbyn/backward-subword-begin)


        ;; (local-set-key (kbd "M-f") 'fill-key-map)
        ;; (local-set-key (kbd "M-a") 'azbyn-key-map)

        ;; (defun azbyn/delete-char-or-region ()
        ;;   (interactive)
        ;;   (if mark-active
        ;;       (call-interactively 'delete-region)
        ;;     (delete-char 1)))


        ;; (local-set-key (kbd "C-d") 'azbyn/delete-char-or-region)
        ;; (local-set-key (kbd "M-d") 'azbyn/kill-word)
        ;; (local-set-key (kbd "C-M-d") 'azbyn/kill-subword)


        ;; (local-set-key (kbd "C-n") 'evil-find-char)
        ;; (local-set-key (kbd "C-b") 'evil-find-char-to-backward)

        ;; ;;(local-set-key (kbd "M-a") 'backward-word)
        ;; ;;(local-set-key (kbd "M-f") 'forward-word)
        ;; (local-set-key (kbd "C-'") 'recenter-top-bottom)
        ;; ;org mode likes rebinding C-k
        ;; (local-set-key (kbd "M-k") 'kill-whole-line)
        ;; (local-set-key (kbd "C-l") 'azbyn/copy-to-eol-or-region)
        ;; (local-set-key (kbd "C-k") 'azbyn/kill-to-eol-or-region)
        ;; (local-set-key (kbd "M-l") (lambda ()
        ;;                         (interactive)
        ;;                         (call-interactively 'evil-yank-line)
        ;;                         (message "yanked line")))

        ;; (local-set-key (kbd "C-p") 'yank); azbyn/paste)
        ;; (local-set-key (kbd "C-S-p") 'azbyn/paste-before)
        ;; (local-set-key (kbd "M-p") 'azbyn/paste)
        ;; (local-set-key (kbd "M-P") 'azbyn/paste-before)

        ;; (local-set-key (kbd "M-n") 'evil-search-next)
        ;; (local-set-key (kbd "M-b") 'evil-search-previous)

        ;;)))
  ;;(add-hook 'after-change-major-mode-hook 'azbyn/key-bindings)
  ;;(add-hook 'dashboard-mode-hook 'azbyn/key-bindings)
  ;;(add-hook 'minibuffer-setup-hook 'azbyn/key-bindings)
  ;;(add-hook 'ivy-mode-hook 'azbyn/key-bindings)

#+END_SRC
* macros
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-9") 'kmacro-start-macro-or-insert-counter)
  (global-set-key (kbd "C-0") 'kmacro-end-or-call-macro)
#+END_SRC
* window size
#+BEGIN_SRC emacs-lisp
  (defun increase-font-size ()
    (interactive)
    (set-face-attribute 'default
                        nil
                        :height
                        (+ 10 (face-attribute 'default :height))))
  (defun decrease-font-size ()
    (interactive)
    (set-face-attribute 'default
                        nil
                        :height
                       (+ -10 (face-attribute 'default :height))))

  (defun default-font-size()
    (interactive)
    (set-face-attribute 'default
                        nil
                        :height
                        107))
  (global-set-key (kbd "H-=") 'default-font-size)
  (global-set-key (kbd "H-+") 'increase-font-size)
  (global-set-key (kbd "H--") 'decrease-font-size)

#+END_SRC
* other bindings
** repeat
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "H-.") 'repeat)
#+END_SRC
** zop-up-to-char
#+BEGIN_SRC emacs-lisp

  ;  (global-set-key (kbd "C-z") 'zap-up-to-char)
  (use-package zop-to-char
    :ensure t
    :config
    (global-set-key [remap zap-up-to-char] 'zop-up-to-char)
    (setq zop-to-char-copy-keys '(?\C-l))
    (setq zop-to-char-delete-keys '(?\C-d))
    )
#+END_SRC
** find-char
#+BEGIN_SRC emacs-lisp
  ;;  (use-package avy
  ;;    :ensure t
  ;;    :bind
  ;;      ("C-z" . avy-goto-char))

 ; (global-set-key (kbd "M-h") 'evil-find-char-to)
;  (global-set-key (kbd "M-S-h") 'evil-find-char-to-backward)
#+END_SRC
#+END_SRC
** comment
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "M-;") 'comment-line)
  (use-package smart-comment
    :ensure t
    :bind ("C-;" . smart-comment))
#+END_SRC

** macros
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-9") 'kmacro-start-macro-or-insert-counter)
  (global-set-key (kbd "C-0") 'kmacro-end-or-call-macro)
#+END_SRC
* compile
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "M-c") 'azbyn/run-make-thing)

  (global-set-key (kbd "M-C") 'compile)
#+END_SRC
* misc
** escape as C-g
#+BEGIN_SRC emacs-lisp

  (define-key key-translation-map (kbd "ESC") (kbd "C-g"))
  ;  (global-set-key (kbd "C-x ESC ESC") nil)
  ;  (global-set-key [escape] (lambda ()
  ;                                (interactive)
  ;                                ;; (minibuffer-keyboard-quit)
  ;                                (execute-kbd-macro (read-kbd-macro "C-g"))))
#+END_SRC

** defun movement
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-M-i") 'beginning-of-defun)
  (global-set-key (kbd "C-M-j") 'end-of-defun)
#+END_SRC
** top and bot
#+BEGIN_SRC emacs-lisp
  (define-key window-numbering-keymap (kbd "M-9") nil)
  (define-key window-numbering-keymap (kbd "M-0") nil)

  (global-set-key (kbd "M-9") 'beginning-of-buffer)
  (global-set-key (kbd "M-0") 'end-of-buffer)
#+END_SRC
** disable the binding in org mode
#+BEGIN_SRC emacs-lisp
  (define-key org-mode-map (kbd "<C-tab>") nil)
#+END_SRC

** =%=, =*=, =#= and other things
#+BEGIN_SRC emacs-lisp
  ;;returns the whole word cursor is over
  (defun azbyn/get-point (fun)
    (funcall fun)
    (point))
  (defun azbyn/get-whole-word ()
    (save-excursion
      (let ((beg (azbyn/get-point 'azbyn/backward-word-begin))
            (end (azbyn/get-point 'azbyn/forward-word-end)))
        (buffer-substring-no-properties beg end))))

  (defun azbyn/swiper-thing-at-point ()
    (interactive)
    (if mark-active
        (swiper (buffer-substring (mark) (point)))
    (swiper (azbyn/get-whole-word))))
  ;; (defun azbyn/swiper-thing-at-point-backward ()
  ;;   (interactive)
  ;;   (if mark-active
  ;;       (swiper))
  ;;   (swiper-backward (azbyn/get-whole-word)))

  (global-set-key (kbd "C-5") 'evil-jump-item)
  (global-set-key (kbd "C-3") 'azbyn/swiper-thing-at-point);;-backward)
  (global-set-key (kbd "C-8") 'azbyn/swiper-thing-at-point)
#+END_SRC
* window movement and management
** resizing and stuff
#+BEGIN_SRC emacs-lisp
  (define-prefix-command 'window-edit-key-map)
  (global-set-key (kbd "M-O") window-edit-key-map)

  (smartrep-define-key
      global-map "M-O"
    '(("i" . evil-window-rotate-upwards)
      ("j" . evil-window-rotate-downwards)

      ("a" . shrink-window-horizontally)
      ("f" . enlarge-window-horizontally)

      ("e" . enlarge-window)
      ("w" . shrink-window)

      ("=" . balance-windows)

      ("M-i" . evil-window-move-very-top)
      ("M-j" . evil-window-move-very-bottom)
      ("M-a" . evil-window-move-far-left)
      ("M-f" . evil-window-move-far-right)

      ("u" . winner-undo)
      ("r" . winner-redo)

      ("o" . next-buffer)
      ("O" . previous-buffer)
      ))

  (global-set-key (kbd "M-O d") 'delete-window)
  (global-set-key (kbd "M-O q") 'delete-window)
  (global-set-key (kbd "M-O k") 'kill-buffer-and-window)
  (global-set-key (kbd "M-O s") 'server-edit)

  (global-set-key (kbd "M-O t") 'toggle-transparency)

  (defun switch-to-minibuffer ()
    "Switch to minibuffer window."
    (interactive)
    (if (active-minibuffer-window)
        (select-window (active-minibuffer-window))
      (error "Minibuffer is not active")))

  (global-set-key (kbd "M-O m") 'switch-to-minibuffer)
  (global-set-key (kbd "M-O SPC") 'switch-to-minibuffer)
  (global-set-key (kbd "M-O C-SPC") 'ivy-resume)


  (global-set-key (kbd "C-t") window-edit-key-map)
  (global-set-key (kbd "C-t C-t") 'recenter-top-bottom)

#+END_SRC
** transparency
#+BEGIN_SRC emacs-lisp
  (define-prefix-command 'transparency-key-map)

  (defun azbyn/the-transparency ()
    (let ((alpha (frame-parameter nil 'alpha)))
      (if (numberp alpha) alpha 100)))
  (defun azbyn/increase-transparency()
    (interactive)
    (let ((alpha (azbyn/the-transparency)))
      (unless (eq alpha 100)
        (set-frame-parameter nil 'alpha (+ alpha 5)))))
  (defun azbyn/decrease-transparency()
    (interactive)
    (let ((alpha (azbyn/the-transparency)))
      (unless (eq alpha 5)
        (set-frame-parameter nil 'alpha (- alpha 5)))))
  (defun azbyn/toggle-transparency()
    (interactive)
    (let ((alpha (azbyn/the-transparency )))
      (if (eq alpha 100)
          (set-frame-parameter nil 'alpha 95)
        (set-frame-parameter nil 'alpha 100))))
  (global-set-key (kbd "C-t t") transparency-key-map)
  (smartrep-define-key
      global-map "C-t t"
    '(("-" . azbyn/decrease-transparency)
      ("+" . azbyn/increase-transparency)
      ("=" . azbyn/increase-transparency)

      ("a" . azbyn/decrease-transparency)
      ("f" . azbyn/increase-transparency)

      ("i" . azbyn/decrease-transparency)
      ("j" . azbyn/increase-transparency)

      ("t" . azbyn/toggle-transparency)
      ))
#+END_SRC
** previous
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "M-o") 'other-window)
  (global-set-key (kbd "C-o") (lambda () (interactive)
      (other-window -1)))
#+END_SRC
* quail stuff
#+BEGIN_SRC emacs-lisp
  (require 'russian-transl)
  (require 'azbyn-tex)
#+END_SRC
